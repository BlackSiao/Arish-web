import{_ as e,c as d,d as a,o as r}from"./app-UDSOE8tV.js";const s={};function o(c,t){return r(),d("div",null,[...t[0]||(t[0]=[a('<p>在运维排查中，经常会遇到某个进程无法正常工作的问题。一般处理方式都是去看该进程的运行日志和启动日志，此时研发没有写好这些日志的处理逻辑的话，则无法获得有用的信息。</p><p>而strace命令提供了一种新的排查思路，通过使用strace命令，我们得以看到进程此时的全部系统调用的内容和返回结果，以此来判断进程此时的运行情况，进而判断整个程序卡在哪个点上。</p><h2 id="工具比较" tabindex="-1"><a class="header-anchor" href="#工具比较"><span>工具比较</span></a></h2><table><thead><tr><th>工具</th><th>关注层级</th><th>核心用途</th></tr></thead><tbody><tr><td>strace</td><td>用户态 ↔ 内核接口（系统调用）</td><td>跟踪程序调用了哪些系统调用、参数与返回值是什么</td></tr><tr><td>ftrace</td><td>内核内部</td><td>跟踪内核函数执行、性能、延迟、调度等更底层行为</td></tr></tbody></table><h3 id="形象比喻" tabindex="-1"><a class="header-anchor" href="#形象比喻"><span>形象比喻</span></a></h3><ul><li><strong>strace</strong>：像是在门口看人进出<br> ➜ 记录程序“请求系统”的所有系统调用（如 <code>open</code>、<code>read</code>、<code>write</code>、<code>socket</code>）。</li><li><strong>ftrace</strong>：像是进去屋里观察内核内部<br> ➜ 分析具体内核函数执行流程、延迟、CPU 调度、软中断等。</li></ul><h2 id="常见误区及解决" tabindex="-1"><a class="header-anchor" href="#常见误区及解决"><span>常见误区及解决</span></a></h2><table><thead><tr><th>常见误区</th><th>原因</th><th>正确做法</th></tr></thead><tbody><tr><td>strace 一开全屏刷日志，看不懂</td><td>系统调用的次数是非常密集的</td><td>用 <code>-e trace=open,read,write</code> 过滤</td></tr><tr><td>忘记 root 权限跑 ftrace</td><td>ftrace 需要较高权限</td><td>使用 <code>sudo</code> 或切 root</td></tr><tr><td>误以为 ftrace 是命令</td><td>其实是内核子系统，不是一条命令</td><td>通过 <code>/sys/kernel/debug/tracing</code> 或 <code>trace-cmd</code> 使用</td></tr><tr><td>想用 strace 分析内核问题</td><td>strace 只能看用户态调用</td><td>内核卡死问题需用 ftrace</td></tr></tbody></table><h2 id="strace-示例" tabindex="-1"><a class="header-anchor" href="#strace-示例"><span>strace 示例</span></a></h2><p>假设现在 <code>snmpd</code> 进程无法正常启动，对应的进程号是：100815。对应的错误日志没有更进一步的信息，此时 可以通过strace命令来查看该进程此时的系统调用。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">strace</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -tt</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> trace=open,read,write</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 100815</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> 2&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> trace.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="选项说明" tabindex="-1"><a class="header-anchor" href="#选项说明"><span>选项说明</span></a></h3><table><thead><tr><th>选项</th><th>作用</th></tr></thead><tbody><tr><td><code>-tt</code></td><td>打印时间戳，分析延迟或卡住位置</td></tr><tr><td><code>-p 100815</code></td><td>附加到目标进程</td></tr><tr><td><code>-e trace=...</code></td><td>只跟踪指定系统调用，减少噪音</td></tr><tr><td><code>2&gt; trace.log</code></td><td>把结果写入日志文件</td></tr></tbody></table><p><strong>注意</strong> strace命令的系统开销还比较大，尽量不要长时间的跑该命令。 下列的故障返回里面的: <strong>ENOENT</strong>和 **&quot;EACCES&quot;**是POSIX（Portable Operating System Interface）标准中定义的系统错误码（errno 值），常用于 Unix-like 系统（如 Linux、macOS）中的文件操作系统调用。</p><p>当遇到不清楚的错误码时，可以查看POSIX的官网对应的说明: https://docs.particle.io/reference/device-os/api/debugging/posix-errors/</p><h2 id="常见故障类型及-strace-命令定位" tabindex="-1"><a class="header-anchor" href="#常见故障类型及-strace-命令定位"><span>常见故障类型及 strace 命令定位</span></a></h2><table><thead><tr><th>故障类型</th><th>在 strace 中会看到的特征系统调用</th></tr></thead><tbody><tr><td>❗ 配置文件缺失 / 路径错误</td><td><code>open(...) = -1 ENOENT (No such file or directory)</code></td></tr><tr><td>🔒 权限不足</td><td><code>open(...) = -1 EACCES (Permission denied)</code></td></tr><tr><td>🧊 程序卡死 / 卡在 IO 或系统调用</td><td>一直重复 <code>read(...)</code> 或卡在 <code>futex(...)</code> 没有返回</td></tr><tr><td>🛑 端口被占用 / 绑定失败</td><td><code>bind(...) = -1 EADDRINUSE</code></td></tr><tr><td>🔗 DNS / 网络问题</td><td><code>connect(...)</code>、<code>getaddrinfo(...)</code> 长时间无响应</td></tr><tr><td>💥 崩溃 / 信号异常</td><td><code>--- SIGSEGV</code>、<code>SIGABRT</code>、<code>SIGKILL</code> 等信号信息</td></tr><tr><td>🧬 库文件缺失 (动态库)</td><td><code>open(&quot;/lib/...&quot;, O_RDONLY) = -1 ENOENT</code></td></tr><tr><td>🧵 多线程死锁</td><td>大量 <code>futex(...)</code> 或 <code>nanosleep(...)</code> 重复</td></tr></tbody></table><h1 id="ps-aux-和-ss-lntp" tabindex="-1"><a class="header-anchor" href="#ps-aux-和-ss-lntp"><span>ps aux 和 ss -lntp</span></a></h1>',18)])])}const n=e(s,[["render",o]]),h=JSON.parse('{"path":"/notes/Linux/kbejdwvs/","title":"strace命令,查看进程的系统调用","lang":"zh-CN","frontmatter":{"title":"strace命令,查看进程的系统调用","createTime":"2025/10/14 11:18:08","permalink":"/notes/Linux/kbejdwvs/","description":"在运维排查中，经常会遇到某个进程无法正常工作的问题。一般处理方式都是去看该进程的运行日志和启动日志，此时研发没有写好这些日志的处理逻辑的话，则无法获得有用的信息。 而strace命令提供了一种新的排查思路，通过使用strace命令，我们得以看到进程此时的全部系统调用的内容和返回结果，以此来判断进程此时的运行情况，进而判断整个程序卡在哪个点上。 工具比较...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"strace命令,查看进程的系统调用\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2026-02-10T08:07:34.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://blackhsiao.com/notes/Linux/kbejdwvs/"}],["meta",{"property":"og:site_name","content":"Black Hsiao 的技术笔记"}],["meta",{"property":"og:title","content":"strace命令,查看进程的系统调用"}],["meta",{"property":"og:description","content":"在运维排查中，经常会遇到某个进程无法正常工作的问题。一般处理方式都是去看该进程的运行日志和启动日志，此时研发没有写好这些日志的处理逻辑的话，则无法获得有用的信息。 而strace命令提供了一种新的排查思路，通过使用strace命令，我们得以看到进程此时的全部系统调用的内容和返回结果，以此来判断进程此时的运行情况，进而判断整个程序卡在哪个点上。 工具比较..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-02-10T08:07:34.000Z"}],["meta",{"property":"article:modified_time","content":"2026-02-10T08:07:34.000Z"}]]},"readingTime":{"minutes":2.81,"words":843},"git":{"createdTime":1770710854000,"updatedTime":1770710854000,"contributors":[{"name":"BlackSiao","username":"BlackSiao","email":"1546600539@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/BlackSiao?v=4","url":"https://github.com/BlackSiao"}]},"autoDesc":true,"filePathRelative":"notes/Linux/strace和ftrace.md","headers":[]}');export{n as comp,h as data};
