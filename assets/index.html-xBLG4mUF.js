import{_ as i,c as e,d as a,o as t}from"./app-UDSOE8tV.js";const h={};function l(n,s){return t(),e("div",null,[...s[0]||(s[0]=[a(`<p>历史上，Linux 的启动一直采用init进程。sudo /etc/init.d/apache2 start</p><p>这种方法有两个缺点。</p><ul><li><p>一是启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。</p></li><li><p>二是启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。</p></li></ul><h2 id="systemd的概述" tabindex="-1"><a class="header-anchor" href="#systemd的概述"><span>Systemd的概述</span></a></h2><p>Systemd 就是为了解决这些问题而诞生的。它的设计目标是，为系统的启动和管理提供一套完整的解决方案。</p><p>根据 Linux 惯例，字母d是守护进程（daemon）的缩写。 Systemd 这个名字的含义，就是它要守护整个系统。</p><p>使用了 Systemd，就不需要再用init了。Systemd 取代了initd，成为系统的第一个进程（PID 等于 1），其他进程都是它的子进程。 $ systemctl --version</p><p>Systemd 的优点是功能强大，使用方便，缺点是体系庞大，非常复杂。事实上，现在还有很多人反对使用 Systemd，理由就是它过于复杂，与操作系统的其他部分强耦合，违反&quot;keep simple, keep stupid&quot;的Unix 哲学。</p><p>Systemd 并不是一个命令，而是一组命令，涉及到系统管理的方方面面</p><h1 id="systemd-服务排查与管理心得" tabindex="-1"><a class="header-anchor" href="#systemd-服务排查与管理心得"><span>Systemd 服务排查与管理心得</span></a></h1><h2 id="一、常用的服务查看与管理命令" tabindex="-1"><a class="header-anchor" href="#一、常用的服务查看与管理命令"><span>一、常用的服务查看与管理命令</span></a></h2><h3 id="_1-列出当前已加载的服务" tabindex="-1"><a class="header-anchor" href="#_1-列出当前已加载的服务"><span>1. 列出当前已加载的服务</span></a></h3><p>查看系统中所有已加载的服务单元（包括是否运行、是否失败等）：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> list-units</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --type=service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-查看单个服务的详细状态" tabindex="-1"><a class="header-anchor" href="#_2-查看单个服务的详细状态"><span>2. 查看单个服务的详细状态</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>示例：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-启动、停止、重启与设置开机自启" tabindex="-1"><a class="header-anchor" href="#_3-启动、停止、重启与设置开机自启"><span>3. 启动、停止、重启与设置开机自启</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> start</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stop</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 设置开机自启</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> disable</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 取消开机自启</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-查看服务对应的-unit-文件" tabindex="-1"><a class="header-anchor" href="#_4-查看服务对应的-unit-文件"><span>4. 查看服务对应的 unit 文件</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cat</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或直接查看物理路径：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>/usr/lib/systemd/system/&lt;service&gt;.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="二、systemd-服务异常排查标准流程" tabindex="-1"><a class="header-anchor" href="#二、systemd-服务异常排查标准流程"><span>二、Systemd 服务异常排查标准流程</span></a></h2><p>当某个服务启动失败时，可按照以下步骤进行分析与定位。</p><h3 id="步骤-1-查看服务状态" tabindex="-1"><a class="header-anchor" href="#步骤-1-查看服务状态"><span>步骤 1：查看服务状态</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查看失败原因概要（通常可看到最近的错误日志片段）。</p><h3 id="步骤-2-查看详细日志" tabindex="-1"><a class="header-anchor" href="#步骤-2-查看详细日志"><span>步骤 2：查看详细日志</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">journalctl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -u</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -b</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>说明：<br><code>-u</code> 指定服务单元，<code>-b</code> 表示仅查看本次开机后的日志。</p><h3 id="步骤-3-检查服务配置文件" tabindex="-1"><a class="header-anchor" href="#步骤-3-检查服务配置文件"><span>步骤 3：检查服务配置文件</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cat</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>确认配置路径、依赖、启动命令等是否正确。</p><h3 id="步骤-4-尝试手动启动服务" tabindex="-1"><a class="header-anchor" href="#步骤-4-尝试手动启动服务"><span>步骤 4：尝试手动启动服务</span></a></h3><p>在命令行中直接运行 <code>ExecStart</code> 中的启动命令，观察是否有错误提示。<br> 这一步可帮助判断问题出在 systemd 本身还是程序配置上。</p><h3 id="步骤-5-检查依赖与系统资源" tabindex="-1"><a class="header-anchor" href="#步骤-5-检查依赖与系统资源"><span>步骤 5：检查依赖与系统资源</span></a></h3><table><thead><tr><th>问题类型</th><th>检查方法</th></tr></thead><tbody><tr><td>依赖服务是否正常</td><td><code>systemctl status &lt;dependency&gt;</code>（如 <code>dbus</code>、<code>network</code> 等）</td></tr><tr><td>端口被占用</td><td><code>ss -lntp</code> 或 <code>lsof -i</code></td></tr><tr><td>权限 / SELinux 问题</td><td><code>getenforce</code>、<code>ls -Z</code></td></tr><tr><td>内存或文件句柄不足</td><td><code>dmesg</code> 查看内核日志</td></tr></tbody></table><hr><h2 id="三、补充建议" tabindex="-1"><a class="header-anchor" href="#三、补充建议"><span>三、补充建议</span></a></h2><ul><li>若服务长期启动失败，可执行：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">journalctl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -xe</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>查看系统级错误详情。</li><li>服务配置修改后需执行：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> daemon-reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>让 systemd 重新加载配置。</li><li>若要恢复服务默认配置，可使用：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> revert</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">servic</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h2 id="systemd和service" tabindex="-1"><a class="header-anchor" href="#systemd和service"><span>systemd和service</span></a></h2><p>安装包下载下来后有:</p><ul><li>cmdb-agent --&gt; 真正干活的二进制文件</li><li>cmdb-agent.service --&gt; systemd的&quot;托管说明书&quot;，说明书里面说了该怎么启动进程，进程挂了怎么拉起这些内容</li><li>deploy.sh(可选) --&gt; 一次性部署脚本，停掉旧agent，准备运行环境，把新的agent注册给systemd并启动</li></ul><p>. systemd接管agent：</p><ul><li>cp cmdb-agent.service /etc/systemd/system(所有被systemd管理的服务都在这里)</li><li>创建软链接 systemctl enable x.service <ul><li>/etc/systemd/system/multi-user.target.wants/cmdb-agent.service 当系统进入multi-user.target(正常开机时)，请启动它</li></ul></li><li>systemctl start cmdb-agent</li></ul>`,48)])])}const r=i(h,[["render",l]]),k=JSON.parse('{"path":"/notes/Linux/z4cszob4/","title":"systemctl","lang":"zh-CN","frontmatter":{"title":"systemctl","createTime":"2025/10/22 16:47:04","permalink":"/notes/Linux/z4cszob4/","description":"历史上，Linux 的启动一直采用init进程。sudo /etc/init.d/apache2 start 这种方法有两个缺点。 一是启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。 二是启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。 Systemd的概述 S...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"systemctl\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2026-02-10T08:07:34.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://blackhsiao.com/notes/Linux/z4cszob4/"}],["meta",{"property":"og:site_name","content":"Black Hsiao 的技术笔记"}],["meta",{"property":"og:title","content":"systemctl"}],["meta",{"property":"og:description","content":"历史上，Linux 的启动一直采用init进程。sudo /etc/init.d/apache2 start 这种方法有两个缺点。 一是启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。 二是启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。 Systemd的概述 S..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-02-10T08:07:34.000Z"}],["meta",{"property":"article:modified_time","content":"2026-02-10T08:07:34.000Z"}]]},"readingTime":{"minutes":3.26,"words":979},"git":{"createdTime":1770710854000,"updatedTime":1770710854000,"contributors":[{"name":"BlackSiao","username":"BlackSiao","email":"1546600539@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/BlackSiao?v=4","url":"https://github.com/BlackSiao"}]},"autoDesc":true,"filePathRelative":"notes/Linux/systemctl.md","headers":[]}');export{r as comp,k as data};
